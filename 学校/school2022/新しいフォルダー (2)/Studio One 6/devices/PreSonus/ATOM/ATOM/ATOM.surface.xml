<?xml version="1.0" encoding="utf-8"?>
<ControlSurface>

	<!-- ******************************************************************************************** -->
	<!-- CONTROL DEFINITIONS -->
	<!-- ******************************************************************************************** -->

	<Controls>

		<!-- ******************************************************************************************** -->
		<!--  Pads transmit Note On for pressed and Note Off for release with velocity -->
		<!--  Pads transmit Poly Pressure -->
		<!--  Color is transmitted with Note On message -->
		<!-- ******************************************************************************************** -->

		<Control name="pad[0]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#24" options="through"/>
		</Control>
		<Control name="padLED[0]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#24"/>
		</Control>
		<Control name="padLEDColor[0]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#24"/>
		</Control>

		<Control name="pad[1]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#25" options="through"/>
		</Control>
		<Control name="padLED[1]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#25"/>
		</Control>
		<Control name="padLEDColor[1]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#25"/>
		</Control>

		<Control name="pad[2]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#26" options="through"/>
		</Control>
		<Control name="padLED[2]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#26"/>
		</Control>
		<Control name="padLEDColor[2]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#26"/>
		</Control>

		<Control name="pad[3]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#27" options="through"/>
		</Control>
		<Control name="padLED[3]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#27"/>
		</Control>
		<Control name="padLEDColor[3]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#27"/>
		</Control>

		<Control name="pad[4]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#28" options="through"/>
		</Control>
		<Control name="padLED[4]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#28"/>
		</Control>
		<Control name="padLEDColor[4]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#28"/>
		</Control>

		<Control name="pad[5]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#29" options="through"/>
		</Control>
		<Control name="padLED[5]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#29"/>
		</Control>
		<Control name="padLEDColor[5]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#29"/>
		</Control>

		<Control name="pad[6]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2A" options="through"/>
		</Control>
		<Control name="padLED[6]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#2A"/>
		</Control>
		<Control name="padLEDColor[6]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#2A"/>
		</Control>

		<Control name="pad[7]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2B" options="through"/>
		</Control>
		<Control name="padLED[7]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#2B"/>
		</Control>
		<Control name="padLEDColor[7]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#2B"/>
		</Control>

		<Control name="pad[8]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2C" options="through"/>
		</Control>
		<Control name="padLED[8]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#2C"/>
		</Control>
		<Control name="padLEDColor[8]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#2C"/>
		</Control>

		<Control name="pad[9]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2D" options="through"/>
		</Control>
		<Control name="padLED[9]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#2D"/>
		</Control>
		<Control name="padLEDColor[9]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#2D"/>
		</Control>

		<Control name="pad[10]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2E" options="through"/>
		</Control>
		<Control name="padLED[10]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#2E"/>
		</Control>
		<Control name="padLEDColor[10]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#2E"/>
		</Control>

		<Control name="pad[11]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#2F" options="through"/>
		</Control>
		<Control name="padLED[11]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#2F"/>
		</Control>
		<Control name="padLEDColor[11]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#2F"/>
		</Control>

		<Control name="pad[12]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#30" options="through"/>
		</Control>
		<Control name="padLED[12]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#30"/>
		</Control>
		<Control name="padLEDColor[12]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#30"/>
		</Control>

		<Control name="pad[13]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#31" options="through"/>
		</Control>
		<Control name="padLED[13]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#31"/>
		</Control>
		<Control name="padLEDColor[13]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#31"/>
		</Control>

		<Control name="pad[14]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#32" options="through"/>
		</Control>
		<Control name="padLED[14]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#32"/>
		</Control>
		<Control name="padLEDColor[14]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#32"/>
		</Control>

		<Control name="pad[15]" type="trigger" options="receive">
			<MidiMessage status="NoteTrigger" address="#33" options="through"/>
		</Control>
		<Control name="padLED[15]" options="transmit fastupdate">
			<MidiMessage status="#90" address="#33"/>
		</Control>
		<Control name="padLEDColor[15]" type="rgb" options="transmit fastupdate">
			<Handler class="PadColorLEDHandler" address="#33"/>
		</Control>

		<!-- ******************************************************************************************** -->
		<!-- 4 x KNOBS -->
		<!-- ******************************************************************************************** -->

		<Control name="knob[0]" title="Knob 1" type="relative" options="receive public pageable">
			<MidiMessage status="#B0" address="#0E" options="signed plain"/>
		</Control>
		<Control name="knob[1]" title="Knob 2" type="relative" options="receive public pageable">
			<MidiMessage status="#B0" address="#0F" options="signed plain"/>
		</Control>
		<Control name="knob[2]" title="Knob 3" type="relative" options="receive public pageable">
			<MidiMessage status="#B0" address="#10" options="signed plain"/>
		</Control>
		<Control name="knob[3]" title="Knob 4" type="relative" options="receive public pageable">
			<MidiMessage status="#B0" address="#11" options="signed plain"/>
		</Control>

		<!-- ******************************************************************************************** -->
		<!-- Pad pressure as CC -->
		<!-- ******************************************************************************************** -->

		<Control name="pressure" title="Pressure" options="receive public">
			<MidiMessage status="#B0" address="#16"/>
		</Control>

		<!-- ******************************************************************************************** -->
		<!--  Buttons -->
		<!-- ******************************************************************************************** -->

		<Control name="setup" type="button" options="receive">
			<MidiMessage status="#B0" address="#56"/>
		</Control>
		<Control name="setloop" type="button" options="receive">
			<MidiMessage status="#B0" address="#55"/>
		</Control>
		<Control name="editor" type="button" options="receive">
			<MidiMessage status="#B0" address="#1F"/>
		</Control>
		<Control name="nudge" type="button" options="receive">
			<MidiMessage status="#B0" address="#1E"/>
		</Control>
		<Control name="showhide" type="button" options="receive">
			<MidiMessage status="#B0" address="#1D"/>
		</Control>
		<Control name="preset" type="button" options="receive">
			<MidiMessage status="#B0" address="#1B"/>
		</Control>
		<Control name="bank" type="button" options="receive">
			<MidiMessage status="#B0" address="#1A"/>
		</Control>
		<Control name="fulllevel" type="button" options="receive">
			<MidiMessage status="#B0" address="#19"/>
		</Control>
		<Control name="noterepeat" type="button" options="receive">
			<MidiMessage status="#B0" address="#18"/>
		</Control>
		<Control name="shift" type="button" options="receive">
			<MidiMessage status="#B0" address="#20"/>
		</Control>
		<Control name="up" type="button" options="receive">
			<MidiMessage status="#B0" address="#57"/>
		</Control>
		<Control name="down" type="button" options="receive">
			<MidiMessage status="#B0" address="#59"/>
		</Control>
		<Control name="left" type="button" options="receive">
			<MidiMessage status="#B0" address="#5A"/>
		</Control>
		<Control name="right" type="button" options="receive">
			<MidiMessage status="#B0" address="#66"/>
		</Control>
		<Control name="select" type="button" options="receive">
			<MidiMessage status="#B0" address="#67"/>
		</Control>
		<Control name="zoom" type="button" options="receive">
			<MidiMessage status="#B0" address="#68"/>
		</Control>
		<Control name="click" type="button" options="receive">
			<MidiMessage status="#B0" address="#69"/>
		</Control>
		<Control name="record" type="button" options="receive">
			<MidiMessage status="#B0" address="#6B"/>
		</Control>
		<Control name="play" type="button" options="receive">
			<MidiMessage status="#B0" address="#6D"/>
		</Control>
		<Control name="stop" type="button" options="receive">
			<MidiMessage status="#B0" address="#6F"/>
		</Control>

		<!-- ******************************************************************************************** -->
		<!--  LEDs -->
		<!-- ******************************************************************************************** -->

		<Control name="setupLED" options="transmit">
			<MidiMessage status="#B0" address="#56"/>
		</Control>
		<Control name="setloopLED" options="transmit">
			<MidiMessage status="#B0" address="#55"/>
		</Control>
		<Control name="editorLED" options="transmit">
			<MidiMessage status="#B0" address="#1F"/>
		</Control>
		<Control name="nudgeLED" options="transmit">
			<MidiMessage status="#B0" address="#1E"/>
		</Control>
		<Control name="showhideLED" options="transmit">
			<MidiMessage status="#B0" address="#1D"/>
		</Control>
		<Control name="presetLED" options="transmit">
			<MidiMessage status="#B0" address="#1B"/>
		</Control>
		<Control name="bankLED" options="transmit">
			<MidiMessage status="#B0" address="#1A"/>
		</Control>
		<Control name="fulllevelLED" options="transmit">
			<MidiMessage status="#B0" address="#19"/>
		</Control>
		<Control name="noterepeatLED" options="transmit">
			<MidiMessage status="#B0" address="#18"/>
		</Control>
		<Control name="shiftLED" options="transmit">
			<MidiMessage status="#B0" address="#20"/>
		</Control>
		<Control name="upLED" options="transmit">
			<MidiMessage status="#B0" address="#57"/>
		</Control>
		<Control name="downLED" options="transmit">
			<MidiMessage status="#B0" address="#59"/>
		</Control>
		<Control name="leftLED" options="transmit">
			<MidiMessage status="#B0" address="#5A"/>
		</Control>
		<Control name="rightLED" options="transmit">
			<MidiMessage status="#B0" address="#66"/>
		</Control>
		<Control name="selectLED"  options="transmit">
			<MidiMessage status="#B0" address="#67"/>
		</Control>
		<Control name="zoomLED" options="transmit">
			<MidiMessage status="#B0" address="#68"/>
		</Control>
		<Control name="clickLED" options="transmit">
			<MidiMessage status="#B0" address="#69"/>
		</Control>
		<Control name="recordLED" options="transmit">
			<MidiMessage status="#B0" address="#6B"/>
		</Control>
		<Control name="playLED" options="transmit">
			<MidiMessage status="#B0" address="#6D"/>
		</Control>
		<Control name="stopLED" options="transmit">
			<MidiMessage status="#B0" address="#6F"/>
		</Control>

		<!-- Color is transmitted with CC message -->
		<Control name="presetLEDColor" type="rgb" options="transmit">
			<Handler class="ButtonColorLEDHandler" address="#1B"/>
		</Control>
		<Control name="bankLEDColor" type="rgb" options="transmit">
			<Handler class="ButtonColorLEDHandler" address="#1A"/>
		</Control>
		<Control name="selectLEDColor" type="rgb" options="transmit">
			<Handler class="ButtonColorLEDHandler" address="#67"/>
		</Control>
		<Control name="playLEDColor" type="rgb" options="transmit">
			<Handler class="ButtonColorLEDHandler" address="#6D"/>
		</Control>

	</Controls>

	<!-- ******************************************************************************************** -->
	<!-- REMOTE CONTROL SECTIONS -->
	<!-- ******************************************************************************************** -->

	<Sections>
		<GenericSection name="main" rows="1" columns="4">
			<foreach variable="$i" count="4">
				<Slot control="knob[$i]" row="0" column="$i"/>
			</foreach>
		</GenericSection>
	</Sections>

	<!-- ******************************************************************************************** -->
	<!-- TEMPLATES -->
	<!-- ******************************************************************************************** -->

	<Templates>
		<!-- Navigation button LED feedback on button press. -->
		<Template name="NavigationButtonDefault">
			<Status control="up" control2="upLED"/>
			<Status control="down" control2="downLED"/>
			<Status control="left" control2="leftLED"/>
			<Status control="right" control2="rightLED"/>
		</Template>
	</Templates>

	<!-- ******************************************************************************************** -->
	<!-- SURFACE MAPPINGS -->
	<!-- ******************************************************************************************** -->

	<Mappings>

		<!-- definitions to use symbolic names (must be kept in sync with script!) -->
		<define name="$PLAY_MODE" value="0"/>
		<define name="$SETUP_MODE" value="1"/>
		<define name="$LOOP_EDIT_MODE" value="2"/>
		<define name="$EVENT_EDIT_MODE" value="3"/>
		<define name="$INSTRUMENT_EDIT_MODE" value="4"/>
		<define name="$BANK_MENU_MODE" value="5"/>
		<define name="$REPEAT_MENU_MODE" value="6"/>
		<define name="$PITCH_MENU_MODE" value="7"/>
		<define name="$RATE_TRIGGER_MODE" value="8"/>
		<define name="$STEP_EDIT_MODE" value="9"/>
		<define name="$RESTORE_PLAY_MODE" value="10"/>

		<!-- Knob control modes, sync with component script. -->
		<define name="$KNOB_MODE_DEFAULT" value="0"/>
		<define name="$KNOB_MODE_SHIFT" value="1"/>
		<define name="$KNOB_MODE_SAMPLER" value="2"/>
		<define name="$KNOB_MODE_SAMPLER_ALT" value="3"/>
		<define name="$KNOB_MODE_SETUP" value="4"/>
		<define name="$KNOB_MODE_LOOP_EDIT" value="5"/>
		<define name="$KNOB_MODE_NOTEREPEATER" value="6"/>

		<!-- Navigation control modes, sync with component script. -->
		<define name="$NAV_MODE_DEFAULT" value="0"/>
		<define name="$NAV_MODE_EXTEND" value="1"/>
		<define name="$NAV_MODE_ZOOM" value="2"/>
		<define name="$NAV_MODE_PRESET" value="3"/>
		<define name="$NAV_MODE_NUDGE" value="4"/>
		<define name="$NAV_MODE_NUDGE_AND_PRESET" value="5"/>
		<define name="$NAV_MODE_BROWSER" value="6"/>
		<define name="$NAV_MODE_COMMAND_PAGING" value="7"/>
		<define name="$NAV_MODE_TRANSPORT" value="8"/>
		<define name="$NAV_MODE_CONTROL_LINK_PAGING" value="9"/>
		<define name="$NAV_MODE_PAD_COPY_PASTE" value="10"/>

		<!-- ******************************************************************************************** -->
		<!-- PAD SECTION -->
		<!-- ******************************************************************************************** -->

		<PadSection name="PadSectionElement" rows="4" roles="musicinput stepedit">
			<foreach variable="$i" count="16">
				<Pad control="pad[$i]">
					<Value control="padLED[$i]" param="state"/>
					<PlainValue control="padLEDColor[$i]" param="color"/>
				</Pad>
			</foreach>
		</PadSection>

		<!-- ******************************************************************************************** -->
		<!-- GENERIC MAPPING (used for "on the fly" control assignment) -->
		<!-- ******************************************************************************************** -->

		<GenericMapping>
			<Bank>
				<Strip name="knob[0]">
					<ParamVariant using="@global" param="knobMode" strict="true">
						<Group value="$KNOB_MODE_DEFAULT, $KNOB_MODE_SETUP, $KNOB_MODE_LOOP_EDIT, $KNOB_MODE_NOTEREPEATER">
							<Relative control="knob[0]" param="value" options="above"/>
						</Group>
					</ParamVariant>
				</Strip>
				<Strip name="knob[1]">
					<ParamVariant using="@global" param="knobMode" strict="true">
						<Group value="$KNOB_MODE_DEFAULT, $KNOB_MODE_SETUP, $KNOB_MODE_LOOP_EDIT, $KNOB_MODE_NOTEREPEATER">
							<Relative control="knob[1]" param="value" options="above"/>
						</Group>
					</ParamVariant>
				</Strip>
				<Strip name="knob[2]">
					<ParamVariant using="@global" param="knobMode" strict="true">
						<Group value="$KNOB_MODE_DEFAULT, $KNOB_MODE_SETUP, $KNOB_MODE_LOOP_EDIT, $KNOB_MODE_NOTEREPEATER">
							<Relative control="knob[2]" param="value" options="above"/>
						</Group>
					</ParamVariant>
				</Strip>
				<Strip name="knob[3]">
					<ParamVariant using="@global" param="knobMode" strict="true">
						<Group value="$KNOB_MODE_DEFAULT, $KNOB_MODE_SETUP, $KNOB_MODE_LOOP_EDIT, $KNOB_MODE_NOTEREPEATER">
							<Relative control="knob[3]" param="value" options="above"/>
						</Group>
					</ParamVariant>
				</Strip>
				<Strip name="pressure">
					<Value control="pressure" param="value" options="above"/>
				</Strip>
			</Bank>
		</GenericMapping>

		<!-- ******************************************************************************************** -->
		<!-- GLOBAL MAPPING -->
		<!-- ******************************************************************************************** -->

		<Global>

			<Radio control="setup" param="padMode" value="$SETUP_MODE" options="toggle" offvalue="$RESTORE_PLAY_MODE"/>
			<Radio control="setupLED" param="padMode" value="$SETUP_MODE"/>

			<Value control="editorLED" param="editorModeActive"/>

			<!-- **************************************************************************************** -->
			<!-- Shift modifier. -->
			<!-- **************************************************************************************** -->

			<ParamVariant param="shiftModifier">

				<!-- **************************************************************************************** -->
				<!-- Shift off. -->
				<!-- **************************************************************************************** -->

				<Group>
					<Radio control="setloop" param="padMode" value="$LOOP_EDIT_MODE" options="toggle" offvalue="$RESTORE_PLAY_MODE"/>
					<Radio control="setloopLED" param="padMode" value="$LOOP_EDIT_MODE"/>

					<Invoke control="editor" onReceive="onEditorButtonPressed"/>
					<!-- special handling in script -->

					<Toggle control="nudge" param="nudgeModifier" options="nonlatching"/>
					<Value control="nudgeLED" param="nudgeModifier"/>

					<Toggle control="preset" param="presetModifier" options="nonlatching"/>
					<Value control="presetLED" param="presetModifier"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Shift on. -->
				<!-- **************************************************************************************** -->

				<Group>
					<Command control="editor" command.category="View" command.name="Editor"/>
					<!-- toggle editor -->
					<!-- <Status control="editor" control2="editorLED"/> -->

					<Command control="setloop" command.category="Transport" command.name="Loop Selection"/>
					<Status control="setloop" control2="setloopLED"/>

					<Command control="nudge" command.category="Event" command.name="Quantize"/>
					<Status control="nudge" control2="nudgeLED"/>

					<Toggle control="preset" param="padFocusMode"/>
					<Value control="presetLED" param="padFocusMode"/>

					<!-- Toggle external device editor. -->
					<using device="Editor">
						<Toggle control="setup" param="open"/>
						<Value control="setupLED" param="open"/>
					</using>
				</Group>

			</ParamVariant>

			<!-- Indicate pad focus on, off. -->
			<ParamVariant param="padFocusMode">
				<PlainValue control="presetLEDColor" param="padFocusOffColor"/>
				<PlainValue control="presetLEDColor" param="padFocusOnColor"/>
			</ParamVariant>

			<!-- Indicate sampler controls on, off. -->
			<ParamVariant param="samplerControlsActive">
				<PlainValue control="selectLEDColor" param="selectButtonColor"/>
				<ParamVariant param="samplerControlMode">
					<!-- Cases: None, Impact, SampleOne-->
					<PlainValue control="selectLEDColor" param="buttonOffColor"/>
					<PlainValue control="selectLEDColor" param="whiteColor"/>
					<PlainValue control="selectLEDColor" param="whiteColor"/>
				</ParamVariant>
			</ParamVariant>

			<Invoke control="showhide" onReceive="onShowHideButtonPressed"/>
			<Status control="showhide" control2="showhideLED"/>

			<Toggle control="fulllevel" param="fullVelocityMode"/>
			<Value control="fulllevelLED" param="fullVelocityMode"/>

			<Radio control="bank" param="padMode" value="$BANK_MENU_MODE" options="toggle nonlatching" offvalue="$RESTORE_PLAY_MODE"/>
			<Radio control="bankLED" param="padMode" value="$BANK_MENU_MODE"/>
			<PlainValue control="bankLEDColor" param="bankButtonColor"/>

			<Toggle control="shift" param="shiftModifier" options="nonlatching"/>
			<Value control="shiftLED" param="shiftModifier"/>

			<Invoke control="select" onReceive="onSelectButtonPressed"/>
			<Status control="select" control2="selectLED"/>

			<!-- **************************************************************************************** -->
			<!-- Pad section modes. -->
			<!-- **************************************************************************************** -->

			<ParamVariant param="padMode" strict="true">

				<!-- **************************************************************************************** -->
				<!-- Default controls for any pad mode. -->
				<!-- **************************************************************************************** -->

				<Group default="true">
					<Toggle control="zoom" param="zoomModifier" options="nonlatching"/>
					<Value control="zoomLED" param="zoomModifier"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Loop edit mode: override zoom controls. -->
				<!-- **************************************************************************************** -->

				<Group value="$LOOP_EDIT_MODE">
					<Command control="zoom" command.category="Zoom" command.name="Zoom to Loop"/>
					<Status control="zoom" control2="zoomLED"/>
				</Group>

			</ParamVariant>

			<!-- **************************************************************************************** -->
			<!-- Knob control modes. -->
			<!-- **************************************************************************************** -->

			<ParamVariant param="knobMode" strict="true">

				<!-- **************************************************************************************** -->
				<!-- Shift hold: control scale and root offset. -->
				<!-- **************************************************************************************** -->

				<Group value="$KNOB_MODE_SHIFT">
					<Relative control="knob[0]" param="scale"/>
					<Relative control="knob[1]" param="rootOffset"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Sampler controls. -->
				<!-- **************************************************************************************** -->

				<Group value="$KNOB_MODE_SAMPLER">
					<!-- Note: sample start/end also serve as loop start/end in Impact. -->
					<Invoke control="knob[0]" onReceive="onSamplerSampleStartMove"/>
					<Invoke control="knob[1]" onReceive="onSamplerSampleEndMove"/>
					<Invoke control="knob[2]" onReceive="onSamplerWheelZoom"/>
					<Invoke control="knob[3]" onReceive="onSamplerWheelScroll"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Sampler alt controls. -->
				<!-- **************************************************************************************** -->

				<Group value="$KNOB_MODE_SAMPLER_ALT">
					<Invoke control="knob[0]" onReceive="onSamplerLoopStartMove"/>
					<Invoke control="knob[1]" onReceive="onSamplerLoopEndMove"/>
					<Invoke control="knob[2]" onReceive="onSamplerWheelZoom"/>
					<Invoke control="knob[3]" onReceive="onSamplerWheelScroll"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Setup mode browser navigation. -->
				<!-- **************************************************************************************** -->

				<Group value="$KNOB_MODE_SETUP">
					<Command control="knob[0]"
						command.category="Navigation" command.name="Down"
						command2.category="Navigation" command2.name="Up"
					/>
					<using device="device:///TransportPanel">
						<Relative control="knob[1]" param="tempo"/>
					</using>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Loop edit mode transport control. -->
				<!-- **************************************************************************************** -->

				<Group value="$KNOB_MODE_LOOP_EDIT">
					<using device="device:///TransportPanel">
						<Relative control="knob[3]" param="freeCursorTime"/>
					</using>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Note repeater controls. -->
				<!-- **************************************************************************************** -->

				<Group value="$KNOB_MODE_NOTEREPEATER">
					<using device="device:///NoteRepeater">
						<Relative control="knob[0]" param="rate"/>
						<Relative control="knob[1]" param="gate"/>
						<Relative control="knob[2]" param="quantize"/>
						<Relative control="knob[3]" param="pressureHandling"/>
					</using>
				</Group>
			</ParamVariant>

			<!-- **************************************************************************************** -->
			<!-- Navigation button modes. -->
			<!-- **************************************************************************************** -->

			<ParamVariant param="navMode" strict="true">

				<!-- **************************************************************************************** -->
				<!-- Default left, right, up, down. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_DEFAULT">
					<include template="NavigationButtonDefault"/>
					<Command control="up" command.category="Navigation" command.name="Up" options="autorepeat"/>
					<Command control="down" command.category="Navigation" command.name="Down" options="autorepeat"/>
					<Command control="left" command.category="Navigation" command.name="Left" options="autorepeat"/>
					<Command control="right" command.category="Navigation" command.name="Right" options="autorepeat"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Zoom controls. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_ZOOM">
					<include template="NavigationButtonDefault"/>
					<Command control="up" command.category="Zoom" command.name="Zoom Out Vertical" options="autorepeat"/>
					<Command control="down" command.category="Zoom" command.name="Zoom In Vertical" options="autorepeat"/>
					<Command control="left" command.category="Zoom" command.name="Zoom Out" options="autorepeat"/>
					<Command control="right" command.category="Zoom" command.name="Zoom In" options="autorepeat"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Extend selection. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_EXTEND">
					<include template="NavigationButtonDefault"/>
					<Command control="up" command.category="Navigation" command.name="Up Extend" options="autorepeat"/>
					<Command control="down" command.category="Navigation" command.name="Down Extend" options="autorepeat"/>
					<Command control="left" command.category="Navigation" command.name="Left Extend" options="autorepeat"/>
					<Command control="right" command.category="Navigation" command.name="Right Extend" options="autorepeat"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Switch presets on up/down. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_PRESET">
					<include template="NavigationButtonDefault"/>
					<Command control="up" command.category="Presets" command.name="Previous" options="autorepeat"/>
					<Command control="down" command.category="Presets" command.name="Next" options="autorepeat"/>
					<Command control="left" command.category="Navigation" command.name="Left" options="autorepeat"/>
					<Command control="right" command.category="Navigation" command.name="Right" options="autorepeat"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!-- Nudge selection on left/right. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_NUDGE">
					<include template="NavigationButtonDefault"/>
					<Command control="up" command.category="Navigation" command.name="Up" options="autorepeat"/>
					<Command control="down" command.category="Navigation" command.name="Down" options="autorepeat"/>
					<Command control="left" command.category="Edit" command.name="Nudge Back" options="autorepeat"/>
					<Command control="right" command.category="Edit" command.name="Nudge" options="autorepeat"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!--  Switch presets on up/down, nudge on left/right. -->
				<!--  Currently unsupported, ATOM can not have two simultaneous modifiers. Will -->
				<!--  cause up, down, left, right to not emit any messages. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_NUDGE_AND_PRESET"/>

				<!-- **************************************************************************************** -->
				<!--  Brwoser navigation, use back/enter for left/right to switch folders. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_BROWSER">
					<include template="NavigationButtonDefault"/>
					<Command control="up" command.category="Navigation" command.name="Up" options="autorepeat"/>
					<Command control="down" command.category="Navigation" command.name="Down" options="autorepeat"/>
					<Command control="left" command.category="Navigation" command.name="Back"/>
					<Command control="right" command.category="Navigation" command.name="Enter"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!--  User commands paging, indicate page number via LED. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_COMMAND_PAGING">
					<using device="PadSection0/Handler1">
						<Radio control="up" param="pageIndex" value="0" />
						<Radio control="down" param="pageIndex" value="1" />
						<Radio control="left" param="pageIndex" value="2"/>
						<Radio control="right" param="pageIndex" value="3" />
					</using>
					<ParamVariant using="PadSection0/Handler1" param="pageIndex">
						<Group value="0">
							<Value control="upLED" param="onLED"/>
						</Group>
						<Group value="1">
							<Value control="downLED" param="onLED"/>
						</Group>
						<Group value="2">
							<Value control="leftLED" param="onLED"/>
						</Group>
						<Group value="3">
							<Value control="rightLED" param="onLED"/>
						</Group>
					</ParamVariant>
				</Group>

				<!-- **************************************************************************************** -->
				<!--  Transport controls. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_TRANSPORT">
					<Command control="up" command.category="Transport" command.name="Set Loop Start"/>
					<Command control="down" command.category="Transport" command.name="Set Loop End"/>
					<Command control="left" command.category="Transport" command.name="Rewind Bar" options="autorepeat"/>
					<Command control="right" command.category="Transport" command.name="Forward Bar" options="autorepeat"/>
				</Group>

				<!-- **************************************************************************************** -->
				<!--  Control Link paging, indicate page number via LED. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_CONTROL_LINK_PAGING">
					<using device="Editor/Paging">
						<Radio control="up" param="pageNumber" value="1" />
						<Radio control="down" param="pageNumber" value="2" />
						<Radio control="left" param="pageNumber" value="3"/>
						<Radio control="right" param="pageNumber" value="4" />
					</using>
					<ParamVariant using="Editor/Paging" param="pageNumber">
						<Group value="0,1">
							<Value control="upLED" param="onLED"/>
						</Group>
						<Group value="2">
							<Value control="downLED" param="onLED"/>
						</Group>
						<Group value="3">
							<Value control="leftLED" param="onLED"/>
						</Group>
						<Group value="4">
							<Value control="rightLED" param="onLED"/>
						</Group>
					</ParamVariant>
				</Group>

				<!-- **************************************************************************************** -->
				<!--  Pad copy paste controls for Impact. -->
				<!-- **************************************************************************************** -->

				<Group value="$NAV_MODE_PAD_COPY_PASTE">
					<Command control="up" command.category="Navigation" command.name="Up" options="autorepeat"/>
					<Command control="down" command.category="Navigation" command.name="Down" options="autorepeat"/>
					<Invoke control="left" onReceive="onSamplerCopy"/>
					<Invoke control="right" onReceive="onSamplerPaste"/>
				</Group>

			</ParamVariant>

		</Global>

		<!-- ******************************************************************************************** -->
		<!-- MIXER MAPPING -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping device="MixerConsole" name="MixerMapping">
			<ScrollBank target="FollowBank" name="FocusBankElement">
				<Strip onConnect="onMixerConsoleFollowBankChanged"/>
			</ScrollBank>
		</DeviceMapping>

		<!-- ******************************************************************************************** -->
		<!-- INSTRUMENT TRACK MAPPINGS -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping device="MusicTrackDevice" name="MusicTrackMapping">
			<Bank target="FocusChannel" name="FocusChannelMapping">
				<Strip onConnect="onMusicTrackFocusChannelChanged"/>
			</Bank>
			<Bank target="FocusInstrument" name="FocusInstrumentMapping">
				<!-- Detect sampler device for sampler controls. -->
				<Strip onConnect="onFocusInstrumentChanged"/>
			</Bank>
		</DeviceMapping>

		<!-- ******************************************************************************************** -->
		<!-- TRANSPORT MAPPING -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping device="TransportPanel">
			<ParamVariant using="@global" param="shiftModifier">
				<!-- Shift off -->
				<Group>
					<Command control="play" command.category="Transport" command.name="Start"/>
					<Value control="playLED" param="start"/>
					<Command control="stop" command.category="Transport" command.name="Stop"/>
					<Value control="stopLED" param="stop"/>
					<Value control="recordLED" param="record"/>
					<Toggle control="record" param="record"/>
				</Group>
				<!-- Shift on -->
				<Group>
					<Command control="play"  command.category="Transport" command.name="Toggle Loop"/>
					<Value control="playLED" param="loop"/>
					<Command control="stop" command.category="Edit" command.name="Undo"/>
					<Value control="stopLED" param="stop"/>
					<Command control="record" command.category="File" command.name="Save"/>
					<Value control="recordLED" param="record"/>
				</Group>
			</ParamVariant>

			<ParamVariant param="loop">
				<Group>
					<using device="@global">
						<PlainValue control="playLEDColor" param="playButtonColor"/>
					</using>
				</Group>
				<Group>
					<using device="@global">
						<PlainValue control="playLEDColor" param="loopButtonColor"/>
					</using>
				</Group>
			</ParamVariant>

		</DeviceMapping>

		<!-- ******************************************************************************************** -->
		<!-- NOTE REPEAT MAPPING -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping name="NoteRepeatElement" device="NoteRepeater" onConnect="onConnectNoteRepeat">
			<Invoke control="noterepeat" onReceive="onNoteRepeatButtonPressed"/>
			<Value control="noterepeatLED" param="active"/>
			<ParamInvoke param="active" onChanged="onActivateNoteRepeat"/>
			<ParamInvoke param="spread" onChanged="onSpreadModeChanged"/>
		</DeviceMapping>

		<!-- ******************************************************************************************** -->
		<!-- METRONOME MAPPING -->
		<!-- ******************************************************************************************** -->

		<DeviceMapping device="Metronome">
			<ParamVariant using="@global" param="shiftModifier">
				<!-- Shift off-->
				<Group>
					<Toggle control="click" param="clickOn"/>
					<Value control="clickLED" param="clickOn"/>
				</Group>
				<!-- Shift on -->
				<Group>
					<Toggle control="click" param="precount"/>
					<Value control="clickLED" param="precount"/>
				</Group>
			</ParamVariant>
		</DeviceMapping>

	</Mappings>
</ControlSurface>
